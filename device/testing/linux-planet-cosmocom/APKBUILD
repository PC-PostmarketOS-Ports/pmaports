# Reference: <https://postmarketos.org/vendorkernel>
# Kernel config based on: arch/arm64/configs/(CHANGEME!)

pkgname=linux-planet-cosmocom
pkgver=4.4
pkgrel=0
pkgdesc="Planet Computers Cosmo Communicator kernel fork"
arch="aarch64"
_carch="arm64"
_flavor="planet-cosmocom"
url="https://kernel.org"
license="GPL-2.0-only"
options="!strip !check !tracedeps pmb:cross-native"
makedepends="
	bash
	bc
	bison
	devicepkg-dev
	flex
	openssl-dev
	perl
"

# Source
_repository="android_kernel_planet_mt6771"
_commit="44007a7f821c8bfc5eda6459b88ddbd0ed96a124"
_config="config-$_flavor.$arch"
source="
    $pkgname_$_commit.tar.gz::https://github.com/PC-Custom-Android-Ports/$_repository/archive/$_commit.tar.gz
    $_config
    00_disable_drvgen.patch
    cust.dtsi
"
builddir="$srcdir/$_repository-$_commit"
_outdir="out"

prepare() {
	default_prepare
	. downstreamkernel_prepare
	cp "$srcdir"/cust.dtsi arch/arm/boot/dts/cust.dtsi
}

build() {
	unset LDFLAGS
	make O="$_outdir" ARCH="$_carch" CC="${CC:-gcc}" \
		KBUILD_BUILD_VERSION="$((pkgrel + 1 ))-postmarketOS"
}

package() {
	downstreamkernel_package "$builddir" "$pkgdir" "$_carch" \
		"$_flavor" "$_outdir"
}

sha512sums="
45bcd8086963b082441b173a6c311998013e13b255943991f9d3023b96e167a159301d23d0cd532fa50c4c4728983e4b9bf39fce8b0c9509097c0becb52a592b  44007a7f821c8bfc5eda6459b88ddbd0ed96a124.tar.gz
372d3f2107055792fef8d43e13e7864e4ef56f351ebb4c72ec7ce6f3ec5bbb7f55bd8e8ce3664d30b92fad3d6fa82f7d507131759c03582b7bcc28c389d03109  config-planet-cosmocom.aarch64
c4431410b6b8ac5eca32e9b8ceb7e82c7d937990287332e20bac27e01da71aac5dcd0d259a97f93e5e1b5d8a56ab0a278736c3186bbf3c58d22330f6386fee25  00_disable_drvgen.patch
"
